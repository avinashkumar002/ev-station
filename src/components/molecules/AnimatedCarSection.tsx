"use client";

import { useState, useEffect, useRef } from "react";
import Car from "@/assets/svgs/Car";
import CarPark from "@/assets/svgs/CarPark";

const AnimatedCarSection = () => {
    const [isCarParked, setIsCarParked] = useState(false);
    const [hasAnimated, setHasAnimated] = useState(false);
    const sectionRef = useRef(null);

    useEffect(() => {
        const observer = new IntersectionObserver(
            ([entry]) => {
                if (entry.isIntersecting && !hasAnimated) {
                    setIsCarParked(true);
                    setHasAnimated(true);
                }
            },
            { threshold: 0.3 }
        );

        if (sectionRef.current) {
            observer.observe(sectionRef.current);
        }

        return () => {
            if (sectionRef.current) {
                observer.unobserve(sectionRef.current);
            }
        };
    }, [hasAnimated]);

    return (
        <div ref={sectionRef} className="relative w-full h-[125px] overflow-hidden">
            {/* Car Park Background - Always visible */}
            <div className="absolute right-0 top-0">
                <CarPark />
            </div>

            {/* P Badge - Fade in when car is parked */}
            <div
                className={`absolute z-10 transition-opacity duration-300 ${isCarParked ? 'opacity-100' : 'opacity-0'
                    }`}
                style={{
                    right: '196px',
                    bottom: '0',
                    transform: 'translateY(-19%)',
                    transitionDelay: '1s'
                }}
            >
                <svg width="26" height="66" viewBox="0 0 26 66" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.838 23.313H10.4248V65.3004H12.838V23.313Z" fill="#132457" />
                    <g opacity="0.4">
                        <path d="M12.838 23.6705H10.4248V65.3001H12.838V23.6705Z" fill="white" />
                    </g>
                    <rect width="25.1039" height="24.3101" rx="4.90341" fill="#2C7FFF" />
                    <path d="M19.7147 9.12874C19.7147 10.0831 19.4956 11.5477 19.0575 12.3457C18.6195 13.128 17.9467 13.7617 17.0392 14.2467C16.1317 14.7317 15.0052 14.9742 13.6596 14.9742H10.7796V17.3429V19.3194C10.7796 19.7527 10.4284 20.1039 9.99511 20.1039H7.94323C7.50994 20.1039 7.15869 19.7527 7.15869 19.3194V4.74512C7.15869 4.23679 7.57077 3.82471 8.0791 3.82471H13.6596C14.9739 3.82471 16.0848 4.05158 16.9923 4.50531C17.8997 4.95905 18.5803 5.58489 19.0341 6.38284C19.4878 7.18079 19.7147 8.09609 19.7147 9.12874ZM13.3545 12.0766C15.1512 12.1114 15.4454 11.2778 15.7396 10.8365C16.0233 10.3462 16.0233 9.78587 16.0233 9.12874C16.0233 8.4716 15.7719 7.76403 15.3964 7.40417C15.0209 7.04431 14.1212 6.76925 13.3545 6.76925H10.6816V12.0766H13.3545Z" fill="#EEF6FF" />
                </svg>
            </div>

            {/* VERIFIED HOSTS Badge */}
            <div
                className={`absolute z-10 transition-opacity duration-300 ${isCarParked ? 'opacity-100' : 'opacity-0'
                    }`}
                style={{
                    right: '90px',
                    top: '40%',
                    transform: 'translateY(-50%)',
                    transitionDelay: '1s'
                }}
            >
                <svg width="71" height="20" viewBox="0 0 71 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <foreignObject
                        x="-3.22092"
                        y="-3.22092"
                        width="76.9887"
                        height="22.4418"
                    >
                        <div
                            style={{
                                backdropFilter: "blur(1.61px)",
                                clipPath: "url(#bgblur_0_99_12050_clip_path)",
                                height: "100%",
                                width: "100%"
                            }}
                        ></div>
                    </foreignObject>

                    <g data-figma-bg-blur-radius="3.22092">
                        <rect width="70.5464" height="16" rx="8" fill="#1B62F5" />
                        <g clipPath="url(#clip1_99_12050)">
                            <path d="M10.786 9.27629C10.7055 9.27629 10.629 9.24408 10.5726 9.18772L9.59831 8.21339C9.48155 8.09663 9.48155 7.90338 9.59831 7.78662C9.71507 7.66986 9.90832 7.66986 10.0251 7.78662L10.786 8.54756L12.5172 6.81633C12.634 6.69957 12.8273 6.69957 12.944 6.81633C13.0608 6.93309 13.0608 7.12634 12.944 7.24309L10.9994 9.18772C10.943 9.24408 10.8665 9.27629 10.786 9.27629Z" fill="white" />
                            <path d="M11.2734 12.3281C11.0197 12.3281 10.7661 12.2435 10.5688 12.0744L9.93265 11.5269C9.86824 11.4705 9.70719 11.4142 9.62264 11.4142H8.93014C8.33427 11.4142 7.85114 10.931 7.85114 10.3351V9.64668C7.85114 9.56213 7.79477 9.40511 7.7384 9.34069L7.19487 8.70053C6.86473 8.31 6.86473 7.694 7.19487 7.30346L7.7384 6.6633C7.79477 6.59888 7.85114 6.44186 7.85114 6.35732V5.66482C7.85114 5.06895 8.33427 4.58581 8.93014 4.58581H9.62667C9.71122 4.58581 9.87226 4.52542 9.93668 4.47308L10.5728 3.92552C10.9674 3.58733 11.5834 3.58733 11.978 3.92552L12.6141 4.47308C12.6785 4.52944 12.8395 4.58581 12.9241 4.58581H13.6085C14.2044 4.58581 14.6875 5.06895 14.6875 5.66482V6.34926C14.6875 6.43381 14.7479 6.59486 14.8043 6.65928L15.3519 7.29541C15.6901 7.68997 15.6901 8.30597 15.3519 8.70053L14.8043 9.33666C14.7479 9.40108 14.6875 9.56213 14.6875 9.64668V10.3311C14.6875 10.927 14.2044 11.4101 13.6085 11.4101H12.9241C12.8395 11.4101 12.6785 11.4705 12.6141 11.5229L11.978 12.0704C11.7807 12.2435 11.527 12.3281 11.2734 12.3281ZM8.93014 5.18973C8.66844 5.18973 8.45506 5.40312 8.45506 5.66482V6.35329C8.45506 6.58278 8.34635 6.87669 8.19738 7.04981L7.65385 7.68997C7.51294 7.85504 7.51294 8.1409 7.65385 8.30597L8.19738 8.94613C8.34635 9.12328 8.45506 9.41316 8.45506 9.64265V10.3311C8.45506 10.5928 8.66844 10.8062 8.93014 10.8062H9.62667C9.86018 10.8062 10.1541 10.9149 10.3312 11.0679L10.9674 11.6155C11.1325 11.7564 11.4223 11.7564 11.5874 11.6155L12.2235 11.0679C12.4007 10.9189 12.6946 10.8062 12.9281 10.8062H13.6126C13.8743 10.8062 14.0877 10.5928 14.0877 10.3311V9.64668C14.0877 9.41316 14.1964 9.11925 14.3494 8.9421L14.8969 8.30597C15.0378 8.1409 15.0378 7.85102 14.8969 7.68594L14.3494 7.04981C14.1964 6.87266 14.0877 6.57875 14.0877 6.34524V5.66482C14.0877 5.40312 13.8743 5.18973 13.6126 5.18973H12.9281C12.6946 5.18973 12.4007 5.08103 12.2235 4.92803L11.5874 4.38048C11.4223 4.23956 11.1325 4.23956 10.9674 4.38048L10.3312 4.93206C10.1541 5.08103 9.85616 5.18973 9.62667 5.18973H8.93014Z" fill="white" />
                        </g>
                        <path d="M19.1187 5.63636L20.2544 9.07102H20.2991L21.4326 5.63636H22.3019L20.7636 10H19.7877L18.2515 5.63636H19.1187ZM22.8767 10V5.63636H25.7148V6.29901H23.6672V7.48366H25.5677V8.14631H23.6672V9.33736H25.7318V10H22.8767ZM26.5212 10V5.63636H28.1576C28.4928 5.63636 28.7741 5.6946 29.0013 5.81108C29.23 5.92756 29.4026 6.09091 29.5191 6.30114C29.637 6.50994 29.6959 6.75355 29.6959 7.03196C29.6959 7.31179 29.6363 7.55469 29.517 7.76065C29.3991 7.9652 29.2251 8.12358 28.9949 8.2358C28.7648 8.34659 28.4822 8.40199 28.1469 8.40199H26.9814V7.74574H28.0404C28.2364 7.74574 28.3969 7.71875 28.5219 7.66477C28.6469 7.60937 28.7393 7.52912 28.7989 7.42401C28.86 7.31747 28.8905 7.18679 28.8905 7.03196C28.8905 6.87713 28.86 6.74503 28.7989 6.63565C28.7378 6.52486 28.6448 6.44105 28.5198 6.38423C28.3948 6.32599 28.2336 6.29688 28.0361 6.29688H27.3117V10H26.5212ZM28.7755 8.02273L29.8557 10H28.9736L27.9126 8.02273H28.7755ZM31.214 5.63636V10H30.4236V5.63636H31.214ZM32.07 10V5.63636H34.8655V6.29901H32.8605V7.48366H34.6737V8.14631H32.8605V10H32.07ZM36.3762 5.63636V10H35.5857V5.63636H36.3762ZM37.2322 10V5.63636H40.0702V6.29901H38.0226V7.48366H39.9232V8.14631H38.0226V9.33736H40.0873V10H37.2322ZM42.3554 10H40.8767V5.63636H42.3852C42.8184 5.63636 43.1906 5.72372 43.5017 5.89844C43.8142 6.07173 44.0542 6.32102 44.2219 6.64631C44.3895 6.97159 44.4733 7.3608 44.4733 7.81392C44.4733 8.26847 44.3888 8.65909 44.2197 8.9858C44.0521 9.3125 43.8099 9.56321 43.4932 9.73793C43.1778 9.91264 42.7986 10 42.3554 10ZM41.6672 9.31605H42.317C42.621 9.31605 42.8746 9.26065 43.0777 9.14986C43.2808 9.03764 43.4335 8.87074 43.5358 8.64915C43.6381 8.42614 43.6892 8.14773 43.6892 7.81392C43.6892 7.48011 43.6381 7.20312 43.5358 6.98295C43.4335 6.76136 43.2822 6.59588 43.0819 6.48651C42.8831 6.37571 42.6359 6.32031 42.3405 6.32031H41.6672V9.31605ZM46.7126 10V5.63636H47.5031V7.48366H49.5251V5.63636H50.3177V10H49.5251V8.14631H47.5031V10H46.7126ZM55.0766 7.81818C55.0766 8.28835 54.9885 8.69105 54.8124 9.02628C54.6377 9.36009 54.3991 9.61577 54.0965 9.79332C53.7954 9.97088 53.4537 10.0597 53.0716 10.0597C52.6895 10.0597 52.3472 9.97088 52.0447 9.79332C51.7435 9.61435 51.5049 9.35795 51.3287 9.02415C51.154 8.68892 51.0667 8.28693 51.0667 7.81818C51.0667 7.34801 51.154 6.94602 51.3287 6.61222C51.5049 6.27699 51.7435 6.0206 52.0447 5.84304C52.3472 5.66548 52.6895 5.5767 53.0716 5.5767C53.4537 5.5767 53.7954 5.66548 54.0965 5.84304C54.3991 6.0206 54.6377 6.27699 54.8124 6.61222C54.9885 6.94602 55.0766 7.34801 55.0766 7.81818ZM54.2819 7.81818C54.2819 7.48722 54.23 7.2081 54.1263 6.98082C54.0241 6.75213 53.882 6.57955 53.7002 6.46307C53.5184 6.34517 53.3089 6.28622 53.0716 6.28622C52.8344 6.28622 52.6249 6.34517 52.4431 6.46307C52.2613 6.57955 52.1185 6.75213 52.0148 6.98082C51.9126 7.2081 51.8614 7.48722 51.8614 7.81818C51.8614 8.14915 51.9126 8.42898 52.0148 8.65767C52.1185 8.88494 52.2613 9.05753 52.4431 9.17543C52.6249 9.2919 52.8344 9.35014 53.0716 9.35014C53.3089 9.35014 53.5184 9.2919 53.7002 9.17543C53.882 9.05753 54.0241 8.88494 54.1263 8.65767C54.23 8.42898 54.2819 8.14915 54.2819 7.81818ZM58.1954 6.83594C58.1755 6.64986 58.0917 6.50497 57.944 6.40128C57.7977 6.29759 57.6073 6.24574 57.373 6.24574C57.2082 6.24574 57.0669 6.2706 56.949 6.32031C56.8311 6.37003 56.7409 6.4375 56.6784 6.52273C56.6159 6.60795 56.5839 6.70526 56.5825 6.81463C56.5825 6.90554 56.6031 6.98437 56.6443 7.05114C56.6869 7.1179 56.7444 7.17472 56.8169 7.22159C56.8893 7.26705 56.9695 7.3054 57.0576 7.33665C57.1457 7.3679 57.2345 7.39418 57.324 7.41548L57.733 7.51776C57.8978 7.55611 58.0562 7.60795 58.2082 7.6733C58.3616 7.73864 58.4987 7.82102 58.6194 7.92045C58.7416 8.01989 58.8382 8.13991 58.9092 8.28054C58.9802 8.42116 59.0157 8.58594 59.0157 8.77486C59.0157 9.03054 58.9504 9.25568 58.8197 9.45028C58.689 9.64347 58.5001 9.79474 58.2529 9.90412C58.0072 10.0121 57.7096 10.0661 57.3602 10.0661C57.0207 10.0661 56.7259 10.0135 56.4759 9.90838C56.2274 9.80327 56.0328 9.64986 55.8921 9.44815C55.7529 9.24645 55.6776 9.00071 55.6663 8.71094H56.444C56.4553 8.86293 56.5022 8.98935 56.5846 9.0902C56.667 9.19105 56.7742 9.26634 56.9063 9.31605C57.0399 9.36577 57.189 9.39062 57.3538 9.39062C57.5257 9.39062 57.6762 9.36506 57.8055 9.31392C57.9362 9.26136 58.0384 9.18892 58.1123 9.09659C58.1862 9.00284 58.2238 8.89347 58.2252 8.76847C58.2238 8.65483 58.1904 8.56108 58.1251 8.48722C58.0597 8.41193 57.9681 8.34943 57.8502 8.29972C57.7338 8.24858 57.5974 8.20312 57.4411 8.16335L56.9447 8.03551C56.5853 7.94318 56.3012 7.80327 56.0924 7.61577C55.885 7.42685 55.7813 7.17614 55.7813 6.86364C55.7813 6.60653 55.8509 6.38139 55.9901 6.18821C56.1308 5.99503 56.3218 5.84517 56.5633 5.73864C56.8048 5.63068 57.0782 5.5767 57.3836 5.5767C57.6933 5.5767 57.9646 5.63068 58.1975 5.73864C58.4319 5.84517 58.6159 5.99361 58.7494 6.18395C58.8829 6.37287 58.9518 6.5902 58.9561 6.83594H58.1954ZM59.5287 6.29901V5.63636H63.0102V6.29901H61.6615V10H60.8774V6.29901H59.5287Z" fill="white" />
                    </g>
                    <defs>
                        <clipPath id="bgblur_0_99_12050_clip_path" transform="translate(3.22092 3.22092)"><rect width="70.5464" height="16" rx="8" />
                        </clipPath><clipPath id="clip1_99_12050">
                            <rect width="9.66275" height="9.66275" fill="white" transform="translate(6.44141 3.16858)" />
                        </clipPath>
                    </defs>
                </svg>
            </div>

            {/* Car - Animates from left to right */}
            <div
                className={`absolute left-0 bottom-0 z-0 transition-all duration-1000 ease-in-out ${isCarParked ? 'translate-x-[calc(650%)]' : 'translate-x-0'
                    }`}
            >
                <Car />
                
                {/* Third SVG - AAA parking spots that appear after car parks */}
                <div
                    className={`absolute transition-opacity duration-300 ${isCarParked ? 'opacity-100' : 'opacity-0'
                        }`}
                    style={{
                        bottom: '1px',
                        left: '2px',
                        transitionDelay: '1s',
                        zIndex: 10
                    }}
                >
                    <svg width="152" height="27" viewBox="0 0 152 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 26.794L3.6518 22.3305L6.49193 0.826294H10.1437L13.866 22.3524L17.3117 26.794H0Z" fill="#407BFF"/>
                        <path d="M4.29785 17.4361H13.0154L11.76 10.175H5.25697L4.29785 17.4361Z" fill="white"/>
                        <path opacity="0.3" d="M3.6518 22.3306L13.866 22.3524L17.3117 26.794H0L3.6518 22.3306Z" fill="black"/>
                        <path d="M71.2617 26.794L74.9135 22.3305L77.7537 0.826294H81.4051L85.1274 22.3524L88.5734 26.794H71.2617Z" fill="#407BFF"/>
                        <path d="M75.5601 17.4361H84.2776L83.0222 10.175H76.5192L75.5601 17.4361Z" fill="white"/>
                        <path opacity="0.3" d="M74.9135 22.3306L85.1274 22.3524L88.5734 26.794H71.2617L74.9135 22.3306Z" fill="black"/>
                        <path d="M134.084 25.9674L137.736 21.5042L140.576 0H144.228L147.95 21.5261L151.396 25.9674H134.084Z" fill="#407BFF"/>
                        <path d="M138.382 16.6094H147.1L145.844 9.34839H139.341L138.382 16.6094Z" fill="white"/>
                        <path opacity="0.3" d="M137.736 21.5042L147.95 21.526L151.396 25.9673H134.084L137.736 21.5042Z" fill="black"/>
                    </svg>
                </div>
            </div>
        </div>
    );
};

export default AnimatedCarSection;